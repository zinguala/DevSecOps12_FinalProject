- name: copy and deploy cluster
  gather_facts: false
  hosts: web

  tasks:
    - name: Create Folder
      file:
        path: /home/ansible/minkube_files
        owner: ansible
        group: sudo
        mode: 0755
        state: directory

    - name: copy minikube deployment config to web1
      ansible.builtin.copy:
        src: /var/lib/jenkins/workspace/pipeline for web1/client-deployment-4replicas.yml
        dest: /home/ansible/minikube_files
        owner: ansible
        group: sudo

    - name: copy minikube deployment config to web1
      ansible.builtin.copy:
        src: /var/lib/jenkins/workspace/pipeline for web1/client-deployment-service.yml
        dest: /home/ansible/minikube_files
        owner: ansible
        group: sudo

    - name: apply the 4 replicas deployment
      ansible.builtin.shell: kubectl apply -f /home/ansible/home/ansible/minikube_files/client-deployment-4replicas.yml
